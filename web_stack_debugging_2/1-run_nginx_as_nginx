#!/bin/bash
# Configures Nginx to run as the nginx user and listen on port 8080

echo "Configuring Nginx to run as the nginx user..."
sudo sed -i 's/user www-data;/user nginx;/g' /etc/nginx/nginx.conf

echo "Configuring Nginx to listen on 0.0.0.0:8080..."
sudo sed -i 's/listen 80;/listen 8080 default_server;/g' /etc/nginx/sites-available/default
sudo sed -i 's/listen \[::\]:80;/listen \[::\]:8080 default_server;/g' /etc/nginx/sites-available/default

echo "Testing Nginx configuration..."
sudo nginx -t

echo "Restarting Nginx..."
sudo systemctl restart nginx

# Check if Nginx is running as nginx user
echo "Checking if Nginx is running as nginx user..."
if ps aux | grep "[n]ginx" | awk '{print $1}' | grep -q "nginx"; then
  echo "Nginx is running as nginx user"
else
  echo "Nginx is NOT running as nginx user"
fi

# Check if Nginx is listening on port 8080
echo "Checking if Nginx is listening on port 8080..."
if ss -tulnp | grep -q ':8080'; then
  echo "Nginx is listening on port 8080"
else
  echo "Nginx is NOT listening on port 8080"
fi
